{% extends 'main/base.html' %}

{% block title %}{{ plant.name }} - Planteer{% endblock %}

{% block content %}

<section class="plant-detail">
    <div class="plant-detail-main">
        <div class="plant-detail-image">
            {% if plant.image %}
                <img src="{{ plant.image.url }}" alt="{{ plant.name }}">
            {% endif %}
        </div>
        <div>
            <div class="plant-actions-header">
                <div class="plant-detail-info-title">{{ plant.name }}</div>
                <div class="plant-actions">
                    {% if user.is_authenticated and user == plant.owner %}
                        <a href="{% url 'plants:plant_update' plant_id=plant.id %}" class="btn-outline">Edit</a>
                        <a href="{% url 'plants:plant_delete' plant_id=plant.id %}" class="btn-delete">Delete</a>
                    {% elif user.is_authenticated and user.is_superuser %}
                        <a href="{% url 'plants:plant_update' plant_id=plant.id %}" class="btn-outline">Edit</a>
                        <a href="{% url 'plants:plant_delete' plant_id=plant.id %}" class="btn-delete">Delete</a>
                    {% endif %}
                </div>

            </div>
            
            <div class="plant-detail-category">{{ plant.category|title }}</div>
            
            <div class="plant-detail-meta">

            <div class="plant-detail-meta">
                <p>{{ plant.description }}</p>

                {% if plant.countries.all %}
                <p>
                    <span class="plant-detail-meta-label">Native to:</span>
                    {% for country in plant.countries.all %}
                        <a href="{% url 'plants:country_detail' country.id %}" class="country-tag">
                            {{ country.name }}
                        </a>
                        {% if not forloop.last %}, {% endif %} 
                    {% endfor %}
                </p>
                {% endif %}

                {% if plant.used_for %}
                <p>
                    <span class="plant-detail-meta-label">Used for:</span>
                    {{ plant.used_for }}
                </p>
                {% endif %}
                
                <p><span class="plant-detail-meta-label">Is Edible:</span>
                   {{ plant.is_edible|yesno:"Yes,No" }}</p>
            </div>
        </div>
    </div>

     <div class="comments-section">
        <h3>Comments ({{ comments|length }})</h3>

        <div class="comment-form-container">
            <h4>Add your comment</h4>

            {% if user.is_authenticated %}
                <p class="comment-user-info">
                    You are commenting as <strong>{{ user.username }}</strong>
                </p>
                <form method="post" class="comment-form">
                    {% csrf_token %}
                    <div class="form-group full-width">
                        <label class="form-label">Comment</label>
                        {{ comment_form.content }}
                    </div>
                    <button type="submit" class="btn">Submit Comment</button>
                </form>
            {% else %}
                <p class="login-message">
                    You must
                    <a href="{% url 'main:login' %}?next={{ request.path }}">log in</a>
                    to add a comment.
                </p>
            {% endif %}
        </div>


        {% for comment in comments %}
        <div class="comment-card">
            <div class="comment-header">
                <div class="comment-name">{{ comment.name }}</div>
                <div class="comment-date">
                    {{ comment.created_at|date:"F j, Y, P" }}
                </div>
            </div>
            <p class="comment-content">{{ comment.content }}</p>
        </div>
        {% empty %}
        <p class="no-comments">No comments yet. Be the first to comment!</p>
        {% endfor %}
    </div>


    <div class="related-section">
        <h3>Related Plants</h3>
        <div class="plants-grid">
            {% for p in related_plants %}
                {% include 'plants/_plant_card.html' with plant=p %}
            {% empty %}
                <p>No related plants.</p>
            {% endfor %}
        </div>
    </div>
</section>

{% endblock %}