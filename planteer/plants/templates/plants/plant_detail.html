{% extends 'base.html' %}

{% block title %}{{ plant.name }}{% endblock %}

{% block content %}
<div class="row mb-5 align-items-start">
  <div class="col-md-6 mb-4 mb-md-0">
    <img src="{{ plant.image.url }}" class="img-fluid plant-detail-img" alt="{{ plant.name }}">
  </div>

  <div class="col-md-6 ps-md-5">
    
    <h1 class="display-5 fw-bold mb-2">{{ plant.name }}</h1>
    
    <p class="text-muted mb-4" style="font-size: 1.1rem;">
      {{ plant.get_category_display }}
    </p>

    <div class="mb-4">
        <p class="text-secondary" style="line-height: 1.7; font-size: 1rem;">
            {{ plant.about }}
        </p>
    </div>

    <div class="d-flex flex-column gap-3">
        <div>
            <span class="detail-label">Is Edible:</span>
            <span class="detail-value">{{ plant.is_edible|yesno:"Yes,No" }}</span>
        </div>

        <div>
            <span class="detail-label">Used For:</span>
            <span class="detail-value text-secondary">{{ plant.used_for }}</span>
        </div>

<div>
  <span class="detail-label">Native To:</span>
  <span class="detail-value text-secondary">
    {% if plant.countries.exists %}
      {% for country in plant.countries.all %}
        <a href="{% url 'plants:country_detail' country.id %}" class="text-decoration-none">
          {{ country.name }}
        </a>{% if not forloop.last %}, {% endif %}
      {% endfor %}
    {% else %}
      Unknown
    {% endif %}
  </span>
</div>
        
        <div>
            <span class="detail-label text-muted small">Added on:</span>
            <span class="detail-value text-muted small">{{ plant.created_at|date:"F j, Y" }}</span>
        </div>
    </div>
    
    {% if user.is_authenticated and user.is_staff %}
    <div class="mt-5 pt-3 border-top">
      <a href="{% url 'plants:plant_update' plant.id %}" class="btn btn-dark px-4 me-2">
        Update
      </a>
      <a href="{% url 'plants:plant_delete' plant.id %}" class="btn btn-outline-danger px-4">
        Delete
      </a>
    </div>
    {%endif%}

  </div>
</div>

<div class="mt-5 pt-5">
    <h3 class="h5 mb-4 text-muted">Related Plants</h3>
    <div class="row g-4">
      {% for p in related_plants %}
        <div class="col-md-6 col-lg-4">
          <div class="plant-card h-100">
            <a href="{% url 'plants:plant_detail' p.id %}" class="d-block text-decoration-none text-reset">
                <img src="{{ p.image.url }}" alt="{{ p.name }}">
                <div>
                    <h5 class="plant-title">{{ p.name }}</h5>
                    <p class="plant-brief">Brief about plant</p>
                    <p class="plant-category">{{ p.get_category_display }}</p>
                </div>
            </a>
          </div>
        </div>
      {% empty %}
        <div class="col-12">
            <p class="text-muted">No related plants found in the same category.</p>
        </div>
      {% endfor %}
    </div>
</div>

<div class="mt-5">
  <h3 class="h5 mb-3">Comments</h3>

  <div class="mb-4">
    {% if plant.comments.exists %}
      {% for comment in plant.comments.all %}
        <div class="card mb-3 p-3">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong>{{ comment.user.username }}</strong>
              <div class="small text-muted">{{ comment.created_at|date:"F j, Y, g:i a" }}</div>
            </div>
          </div>
          <p class="mt-2 mb-0">{{ comment.content|linebreaksbr }}</p>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted">No comments yet. Be the first to comment!</p>
    {% endif %}
  </div>

<div class="card p-3">
  <h5 class="mb-3">Add a comment</h5>

  {% if user.is_authenticated %}
    <form method="post" novalidate>
      {% csrf_token %}
      {{ comment_form.non_field_errors }}

      <div class="mb-3">
        {# only show content field (textarea) #}
        {{ comment_form.content.label_tag }}
        {{ comment_form.content }}
        {% for err in comment_form.content.errors %}
          <div class="text-danger small">{{ err }}</div>
        {% endfor %}
      </div>

      <button type="submit" class="btn btn-dark">Submit</button>
    </form>

  {% else %}
    <p class="mb-3 text-muted">You must be logged in to post a comment.</p>
    <a class="btn btn-outline-dark" href="{% url 'accounts:login' %}?next={{ request.path|urlencode }}">
      Login to write a comment
    </a>
  {% endif %}
</div>


{% endblock %}
