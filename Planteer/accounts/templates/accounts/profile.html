{% extends 'main/base.html' %}
{% load static %}

{% block title %}Profile{% endblock %}

{% block content %}
<div class="profile-wrapper container my-5">
    
    {% if form %}
    <div class="row justify-content-center mb-5">
        <div class="col-md-8 col-lg-6"> 
            <div class="card shadow-sm p-4 profile-edit-form">
                <h2 class="card-title text-center mb-4 text-success">Edit Profile</h2>
                
                {% for message in messages %}
                    <div class="alert alert-success" role="alert">{{ message }}</div>
                {% endfor %}

                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="{{ form.about.id_for_label }}" class="form-label fw-bold">{{ form.about.label }}</label>
                        {{ form.about }}
                        {% for error in form.about.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.website_link.id_for_label }}" class="form-label fw-bold">{{ form.website_link.label }}</label>
                        {{ form.website_link }}
                        {% for error in form.website_link.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.avatar.id_for_label }}" class="form-label fw-bold">{{ form.avatar.label }}</label>
                        {{ form.avatar }}
                        {% for error in form.avatar.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>

                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                    
                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-success btn-lg">Save Changes</button>
                        <a href="{% url 'accounts:user_profile_view' user_name=user.username %}" class="btn btn-outline-secondary btn-lg">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endif %}
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="profile-card card shadow-sm text-center p-4">

                <div class="profile-img-box mx-auto mb-3" style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; border: 3px solid #6c757d;">
                    <img src="{{ user_profile.avatar.url }}" alt="Profile Picture" class="profile-img w-100 h-100 object-fit-cover">
                </div>

                <h2 class="profile-name fs-4 fw-bold mb-1">
                    {{ user.first_name }} {{ user.last_name }}
                </h2>

                <p class="profile-username text-muted mb-1">@{{ user.username }}</p>

                {% if user.email %}
                    <p class="profile-email text-secondary mb-3">{{ user.email }}</p>
                {% endif %}

                {% if user_profile.about %}
                    <p class="profile-bio card-text p-2 border-top border-bottom my-3">{{ user_profile.about }}</p>
                {% endif %}

                {% if user_profile.website_link %}
                    <a href="{{ user_profile.website_link }}" target="_blank" class="profile-website text-primary mb-3">
                        Visit Website
                    </a>
                {% endif %}
                
                {% if user == request.user and not form %} 
                <div class="mt-3">
                    <a href="{% url 'accounts:profile_update_view' %}" class="btn btn-warning btn-md shadow">Edit Profile</a>
                </div>
                {% endif %}
                
                {% if user_reviews %}
                <div class="mt-5 pt-3 border-top text-start">
                    <h5 class="fw-bold mb-3">Reviews & Comments ({{ user_reviews.count }})</h5>
                    <ul class="list-group list-group-flush">
                        {% for review in user_reviews %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ review.content|slice:":50" }}...</span>
                                <small class="text-muted">{{ review.created_at|date:"Y-m-d" }}</small>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

            </div>
        </div>
    </div>

</div>

{% endblock %}