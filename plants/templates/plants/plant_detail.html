{% extends "base.html" %}
{% block title %}{{ plant.name }}{% endblock %}
{% block content %}

<!-- ================== تفاصيل النبتة ================== -->
<section class="detail-layout">
  <!-- الصورة -->
  <div class="detail-image">
    {% if plant.image %}
      <img src="{{ plant.image.url }}" alt="{{ plant.name }}">
    {% else %}
      <div style="height:260px; display:flex; align-items:center; justify-content:center; color:#9ca3af;">
        No image available
      </div>
    {% endif %}
  </div>

  <!-- المعلومات -->
  <div>
    <h1 class="hero-title" style="font-size:1.8rem;">{{ plant.name }}</h1>

    <p class="detail-meta">
      Category: {{ plant.category|title }} ·
      {% if plant.is_edible %}Edible{% else %}Not edible{% endif %}
    </p>

    <p class="detail-meta">
      Added at: {{ plant.created_at|date:"Y-m-d H:i" }}
    </p>

    <h3 style="margin-top:1.2rem; margin-bottom:0.3rem;">About</h3>
    <p>{{ plant.about }}</p>

    <h3 style="margin-top:1.2rem; margin-bottom:0.3rem;">Used for</h3>
    <p>{{ plant.used_for }}</p>

    <div class="detail-actions">
      <a href="{% url 'plants:update' plant.id %}" class="btn btn-outline">Update</a>
      <a href="{% url 'plants:delete' plant.id %}" class="btn btn-primary">Delete</a>
    </div>
  </div>
</section>

<!-- ================== النباتات المرتبطة ================== -->
<section style="margin-top: 2.5rem;">
  <div class="section-header">
    <h2 class="section-title">Related plants</h2>
    <span class="section-sub">Same category</span>
  </div>

  <div class="plant-grid">
    {% for p in related_plants %}
      <article class="plant-card">
        {% if p.image %}
          <img src="{{ p.image.url }}" alt="{{ p.name }}">
        {% endif %}
        <div class="plant-card-body">
          <h3 class="plant-card-name">{{ p.name }}</h3>
          <p class="plant-card-meta">
            {{ p.category|title }} ·
            {% if p.is_edible %}Edible{% else %}Not edible{% endif %}
          </p>
          <a href="{% url 'plants:detail' p.id %}" class="plant-card-link">View →</a>
        </div>
      </article>
    {% empty %}
      <p class="section-sub">No related plants found.</p>
    {% endfor %}
  </div>
</section>

<!-- ================== قائمة التعليقات ================== -->
<section style="margin-top: 2.5rem;">
    <h2 class="section-title">Comments ({{ comments.count }})</h2>

    {% if comments %}
        <ul class="comment-list">
            {% for comment in comments %}
                <li class="comment-item" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                    
                    <p class="comment-meta" style="font-weight: bold; color: #555;">
                        {{ comment.user.username }} 
                        
                        <span style="font-weight: normal; font-size: 0.85em; color: #999;">
                            • {{ comment.created_at|date:"Y-m-d H:i" }}
                        </span>
                    </p>
                    
                    <p>{{ comment.content|linebreaks }}</p>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="section-sub" style="color: #777;">No comments yet. Be the first to comment.</p>
    {% endif %}
</section>
<!-- ================== فورم إضافة تعليق ================== -->
{% if user.is_authenticated %}

    <section class="form-card" style="margin-top: 1.5rem;">
        <h3 class="section-title" style="margin-bottom: 1rem;">Add a comment</h3>
        
        <form method="post" action="{% url 'plants:add_comment' plant.id %}">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button type="submit" class="btn btn-primary">إرسال</button>
        </form>
    </section>

{% else %}

    <div style="margin-top: 1.5rem; padding: 15px; background-color: #f8f9fa; border-radius: 8px; text-align: center;">
        <p>عذراً، يجب عليك <a href="{% url 'accounts:login' %}" style="font-weight: bold;">تسجيل الدخول</a> لتتمكن من كتابة تعليق.</p>
    </div>

{% endif %}
{% endblock %}
